<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ログインページ風 サイズ情報ログ</title>
    <style>
        body {
            margin: 0;
            padding: 5vh 0; /* 上下5vhのパディング */
            font-family: sans-serif;
            background-color: #f0f2f5;
            min-height: 100vh; /* ページの高さは少なくとも100vh */
            box-sizing: border-box; /* paddingを含めて高さ計算 */
            position: relative; /* 子要素のabsolute/fixedの基準になりうるが、fixedはviewport基準なので必須ではない */
        }

        /* 元のサイズ情報表示エリアとダミーコンテンツを非表示にする */
        #size-info-area, #long-content-container {
            display: none !important; /* 重要な要素なので!importantで強制的に非表示 */
        }

        .login-container {
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px; /* フォームの最大幅 */
            margin: 0 auto 30px auto; /* 中央寄せと、下部にスペースを追加 */
            text-align: center;
            box-sizing: border-box; /* パディングを含めて幅計算 */
            position: relative; /* 警告オーバーレイのためにpositionを追加 */
            z-index: 1; /* オーバーレイより手前に表示 */
        }

        .login-container h2 {
            margin-top: 0;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left; /* ラベルや入力を左寄せ */
        }

        .form-group label {
            display: block; /* ラベルをブロック要素にして改行 */
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input[type="text"],
        .form-group input[type="password"] {
            width: 100%; /* 親要素の幅いっぱいに */
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            box-sizing: border-box; /* パディングを含めて幅計算 */
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0056b3;
        }

        /* 警告メッセージの新しいスタイル（オーバーレイとして表示） */
        #size-warning {
            display: none; /* 初期状態では非表示 */
            position: fixed; /* 画面に固定 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* 半透明の黒背景 */
            color: white; /* 白いテキスト */
            font-size: 2em; /* 目立つ文字サイズ */
            font-weight: bold;
            text-align: center;
            z-index: 1000; /* 他の要素よりずっと手前に */
            /* コンテンツ（テキスト）を中央に配置 */
            /* display: flex; はJSで設定する */
            justify-content: center;
            align-items: center;
            /* テキストの影を追加して読みやすく */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* 新しい関連コンテンツエリアのスタイル */
        .related-content {
            max-width: 400px; /* ログインフォームと同じ幅に */
            margin: 20px auto; /* 中央寄せと、上下にスペースを追加 */
            padding: 20px;
            background-color: #e9ecef; /* 少し異なる背景色 */
            border-radius: 8px;
            font-size: 0.9em;
            color: #555;
            line-height: 1.6;
            box-sizing: border-box; /* パディングを含めて幅計算 */
            position: relative; /* z-indexの指定のためpositionを追加 */
            z-index: 1; /* オーバーレイより手前に表示（login-containerと同じでOK） */
        }

        .related-content h3 {
            margin-top: 0;
            color: #333;
        }

        .related-content p {
            margin-bottom: 15px;
        }

        .related-content ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .related-content li {
             margin-bottom: 5px;
        }

    </style>
</head>
<body>

    <div class="login-container">
        <h2>サービスへログイン</h2>
        <div class="form-group">
            <label for="username">ユーザー名 または メールアドレス</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div class="form-group">
            <label for="password">パスワード</label>
            <input type="password" id="password" name="password" required>
        </div>
        <button type="submit">ログイン</button>

        </div>

    <div class="related-content">
        <h3>ご利用について</h3>
        <p>このページはデモンストレーション用です。実際のログイン機能はありません。</p>
        <p>ブラウザの開発者ツール (F12キーなど) のコンソールタブを開くと、ウィンドウ/画面サイズの様々な情報がログとして表示されます。</p>
        <ul>
            <li>初期表示時</li>
            <li>ページ読み込み完了時 (Load)</li>
            <li>ウィンドウサイズ変更時 (Resize)</li>
            <li>ページを閉じたり移動したりする際 (Unload)</li>
        </ul>
        <p>特にリサイズ時には、サイズが実際には変わっていない場合でもリサイズイベントが発生することがあり、その際に画面全体を覆う警告メッセージが表示されます。</p>
        <p>このコンテンツエリアは、ページの高さを増やし、モバイル端末などでスクロールが必要になるように配置されています。</p>
           <p style="text-align: center; margin-top: 20px;">--- ページ最下部付近 ---</p>
    </div>

    <div id="size-warning"></div>


    <div id="size-info-area" style="display: none;">
        <h1>ブラウザ・ウィンドウサイズ情報ログ (非表示)</h1>
        <p>このエリアはログインページ風にするために非表示になっています。</p>
        </div>

    <div id="long-content-container" style="display: none;">
        <h2>スクロールを発生させるためのダミーコンテンツエリア (非表示)</h2>
        <p>このエリアはログインページ風にするために非表示になっています。</p>
        <div class="content-filler">ダミーコンテンツ その1</div>
        </div>


    <script>
        // 以前のウィンドウサイズを記録するための変数
        let previousWidth = -1;
        let previousHeight = -1;

        // ★ ページロード完了フラグ
        let isPageLoaded = false;

        // 警告メッセージを表示するHTML要素を取得
        const sizeWarningElement = document.getElementById('size-warning');

        // サイズ情報を取得してconsole.logに出力する関数
        // イベントの種類を引数で受け取る
        function logCurrentSizes(eventTrigger) {
            console.log(`--- \u30A6\u30A3\u30F3\u30C9\u30A6/\u753B\u9762\u30B5\u30A4\u30BA\u60C5\u5831 (${eventTrigger}) ---`);
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] \u30ED\u30B0\u30C8\u30EA\u30AC\u30FC: ${eventTrigger}`);

            // 現在のサイズを取得
            const currentWidth = window.innerWidth;
            const currentHeight = window.innerHeight;

            console.log('\u30A6\u30A3\u30F3\u30C9\u30A6\u306E\u30D3\u30E5\u30FC\u30DD\u30FC\u30C8\u30B5\u30A4\u30BA (window.innerWidth/innerHeight):', currentWidth, 'x', currentHeight);
            console.log('\u30A6\u30A3\u30F3\u30C9\u30A6\u5168\u4F53\u306E\u30B5\u30A4\u30BA (window.outerWidth/outerHeight):', window.outerWidth, 'x', window.outerHeight);
            console.log('\u753B\u9762\u306E\u89E3\u50CF\u5EA6 (screen.width/height):', screen.width, 'x', screen.height);
            console.log('\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u8981\u7D20\u306E\u30AF\u30E9\u30A4\u30A2\u30F3\u30C8\u30B5\u30A4\u30BA (<html>):', document.documentElement.clientWidth, 'x', document.documentElement.clientHeight);
            console.log('\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u5168\u4F53\u306E\u30B9\u30AF\u30ED\u30FC\u30EB\u53EF\u80FD\u306A\u30B5\u30A4\u30BA (<html>):', document.documentElement.scrollWidth, 'x', document.documentElement.scrollHeight);
            console.log('\u30DC\u30C7\u30A3\u8981\u7D20\u306E\u30AF\u30E9\u30A4\u30A2\u30F3\u30C8\u30B5\u30A4\u30BA (<body>):', document.body.clientWidth, 'x', document.body.clientHeight);
            console.log('\u30DC\u30C7\u30A3\u8981\u7D20\u306E\u30B9\u30AF\u30ED\u30FC\u30EB\u53EF\u80FD\u306A\u30B5\u30A4\u30BA (<body>):', document.body.scrollWidth, 'x', document.body.scrollHeight);
            console.log('\u73FE\u5728\u306E\u30B9\u30AF\u30ED\u30FC\u30EB\u4F4D\u7F6E (window.scrollX/scrollY):', window.scrollX, 'x', window.scrollY);

            console.log('---------------------------------');

            // Resizeイベントの場合のみ、サイズ変化をチェックし警告を表示/非表示する
            if (eventTrigger === 'Resize') {
                 // ★ ページロード完了前であれば、警告表示ロジックは実行しない
                if (!isPageLoaded) {
                    console.log('Resizeイベント発生。しかしページロード完了前のため警告表示はスキップ。');
                    // ロード完了前にリサイズでサイズが変わった場合のために、ここでサイズを記録しておくのはあり
                    if (previousWidth === -1 || previousHeight === -1) {
                         previousWidth = currentWidth;
                         previousHeight = currentHeight;
                         console.log('初回Resizeイベント検出。現在のサイズを記録:', previousWidth, 'x', previousHeight);
                    }
                    return; // ロード完了前なので、ここで処理を終了
                }


                // 初回Resizeイベント時、またはロード完了前にResizeが発生した場合は、サイズを記録するだけ
                // isPageLoaded フラグを導入したので、このブロックはロード完了後には入らなくなります。
                // ロード完了前のResizeイベントは上記の !isPageLoaded チェックでスキップされます。
                // ロード完了後に初めてResizeイベントが発生した場合は、previousWidth/Heightはloadイベントで設定されているはずです。
                // なので、以下の !isPageLoaded でスキップされるロジックはもはや不要かもしれません。
                // 一旦残しておき、挙動を確認後に削除を検討しても良いでしょう。

                // if (previousWidth === -1 || previousHeight === -1) {
                //     previousWidth = currentWidth;
                //     previousHeight = currentHeight;
                //     console.log('Resizeイベント初回検出またはロード前Resize。現在のサイズを記録:', previousWidth, 'x', previousHeight);
                //     if (sizeWarningElement) { // 要素が存在するかチェック
                //         sizeWarningElement.style.display = 'none'; // 警告を非表示
                //     }
                // } else { // ロード完了後にこのブロックに入る場合
                    // 前回のサイズと比較
                    if (currentWidth === previousWidth && currentHeight === previousHeight) {
                        // サイズが変化していない場合
                        const warningText = `\u26A0\uFE0F \u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8\u304C\u53D6\u5F97\u3055\u308C\u307E\u3057\u305F\uFF01 \u26A0\uFE0F`;
                         if (sizeWarningElement) { // 要素が存在するかチェック
                             sizeWarningElement.textContent = warningText;
                             // style.display はCSSでflexにしているので 'flex' にする
                             sizeWarningElement.style.display = 'flex'; // オーバーレイを表示
                         }
                         // Consoleの警告テキストも変更
                         console.warn(`\u26A0\uFE0F \u30EA\u30B5\u30A4\u30BA\u30A4\u30D9\u30F3\u30C8\u767A\u751F (${timestamp})\u3002\u3057\u304B\u3057\u30B5\u30A4\u30BA(${currentWidth}x${currentHeight}) \u306F\u5909\u5316\u305B\u305A\u300C${warningText}\u300D\u3092\u8868\u793A \u26A0\uFE0F`);
                    } else {
                        // サイズが変化した場合
                         if (sizeWarningElement) { // 要素が存在するかチェック
                             sizeWarningElement.style.display = 'none'; // 警告を非表示
                         }
                         previousWidth = currentWidth;
                         previousHeight = currentHeight;
                         console.log('\u30B5\u30A4\u30BA\u304C\u5909\u5316\u3057\u307E\u3057\u305F\u3002\u65B0\u3057\u3044\u30B5\u30A4\u30BA\u3092\u8A18\u9332:', previousWidth, 'x', previousHeight);
                    }
                // } // isPageLoaded チェックで囲ったので、この else ブロックは不要になる
            }
        }

        // --- 各タイミングでのログ出力と処理 ---

        // 1. ページが開かれた直後（スクリプト実行時）
        // この時点では isPageLoaded は false なので、Resizeイベントが発生しても警告は出ない
        logCurrentSizes('初期スクリプト実行時');

        // 2. DOMContentLoaded イベント時
        // この時点でも isPageLoaded は false
        window.addEventListener('DOMContentLoaded', () => {
            logCurrentSizes('DOMContentLoaded');
        });

        // 3. Load イベント時
        // ページ全体の読み込み完了後、最初の正確なサイズを取得＆記録
        window.addEventListener('load', () => {
            logCurrentSizes('Load');
            // ページロード完了時のサイズを「前回のサイズ」として記録開始
            previousWidth = window.innerWidth;
            previousHeight = window.innerHeight;
            console.log('Loadイベント完了。現在のサイズを「前回のサイズ」として記録開始:', previousWidth, 'x', previousHeight);
            // ★ ここでページロード完了フラグを立てる
            isPageLoaded = true;
            console.log('isPageLoaded = true に設定しました。リサイズイベントでの警告表示が有効になります。');

             // Load完了時点でサイズが変わっていないリサイズイベントが発生していた場合の対処は不要
             // Load完了前のResizeは上記 isPageLoaded チェックでスキップされているため
        });


        console.log("現在のvisualViewportの幅:", window.visualViewport.width);
        console.log("現在のvisualViewportの高さ:", window.visualViewport.height);
        console.log("現在のvisualViewportのオフセットX:", window.visualViewport.offsetLeft);
        console.log("現在のvisualViewportのオフセットY:", window.visualViewport.offsetTop);
        console.log("現在のvisualViewportのスケール:", window.visualViewport.scale);
        console.log("現在のvisualViewportのページX:", window.visualViewport.pageLeft);
        console.log("現在のvisualViewportのページY:", window.visualViewport.pageTop);

        window.visualViewport.addEventListener('resize', () => {
  console.log('visualViewport がリサイズされました。');
  console.log('新しい幅:', window.visualViewport.width);
  console.log('新しい高さ:', window.visualViewport.height);
  console.log('オフセット X:', window.visualViewport.offsetLeft);
  console.log('オフセット Y:', window.visualViewport.offsetTop);
    console.log('スケール:', window.visualViewport.scale);
    console.log('ページ X:', window.visualViewport.pageLeft);
    console.log('ページ Y:', window.visualViewport.pageTop);
});

        // 4. Resize イベント時
        // ウィンドウサイズ変更時に logCurrentSizes 関数内で比較・警告表示を行う
        window.addEventListener('resize', () => {
            // logCurrentSizes 関数内でResizeイベントの処理を行う
            // ★ logCurrentSizes 関数内で isPageLoaded をチェックするようになった
            logCurrentSizes('Resize');
            // 注意: リサイズ中はイベントが頻繁に発生するため、ログや警告も多くなります。
            // ブラウザや環境によっては、ピクセル単位でサイズが変わらなくてもリサイズイベントが発火することがあります。
        });

        // 5. Unload イベント時
        window.addEventListener('unload', () => {
             console.log('--- \u30A6\u30A3\u30F3\u30C9\u30A6/\u753B\u9762\u30B5\u30A4\u30BA\u60C5\u5831 (Unload \u30A4\u30D9\u30F3\u30C8) ---');
             const timestamp = new Date().toLocaleTimeString();
             console.log(`[${timestamp}] \u30DA\u30FC\u30B8\u3092\u9589\u3058\u307E\u3059/\u79FB\u52D5\u3057\u307E\u3059\u3002Unload\u30A4\u30D9\u30F3\u30C8\u767A\u751F`);
             console.log('\u6700\u7D42\u7684\u306A\u30D3\u30E5\u30FC\u30DD\u30FC\u30C8\u30B5\u30A4\u30BA (Unload\u6642):', window.innerWidth, 'x', window.innerHeight);
             console.log('---------------------------------');
             // Unload時では、DOM要素へのアクセスや console.log の表示が保証されません。
        });

    </script>

</body>
</html>
